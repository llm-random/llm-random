parent: configs/baselines/gpt/expert_choice/granularity/4/medium.yaml
md5_parent_hash: 25eb0c53963eb1c7d96c91bb327c2a20
time: "05:00:00"
interactive_debug_session: false
interactive_debug: false
gpus: 1
cpus_per_gpu: 32

params:
  name: "relative_lr_pr_test_quick"
  tags: ["debug", "relative_lr"]

  ff_mode: token_choice
  capacity_factor: 1.0
  activation_type: silu
  moe_inner_expert: ff_gated

  expansion_rate: 8
  granularity: 1
  get_router_values_from: weights
  layer_norm_in_expert_choice: False

  batch_size: 256
  cutoff: 256

  n_steps: 10_240
  final_lr_step: 10_240
  lr_warmup_steps: 102

  scheduler: cosine
  final_lr_fraction: 0.066666
  init_scale: 0.333
  learning_rate: 0.001
  weight_decay: 0.15

  save_weights_interval: 0
  mixed_precision: True
  loss_checkpoint_chungs: 8

  # relative_lr:
  #   embedding_layer: 1.
  #   head: 1.
  #   gating: 1.
  #   expert_inner_function: 1.
  #   projection: 1.

  # # relative_init_scale:
  # #   embedding_layer: 1.
  # #   head: 1.
  # #   gating: 1.
  # #   expert_inner_function: 1.

  # relative_scheduler_fraction:
  #   embedding_layer: 1.
  #   head: 1.
  #   gating: 1.
  #   expert_inner_function: 1.
  #   projection: 1.

  relative_lr:
    embedding_layer: 3.333
    head: 0.666
    gating: 0.666
    expert_inner_function: 0.3
    projection: 2.5

  # relative_init_scale:
  #   embedding_layer: 1.
  #   head: 1.
  #   gating: 1.
  #   expert_inner_function: 1.

  relative_scheduler_fraction:
    embedding_layer: 0.666
    head: 0.666
    gating: 1.
    expert_inner_function: 1.125
    projection: 1.