parent: configs/baselines/gpt/expert_choice/granularity/4/medium.yaml
md5_parent_hash: 25eb0c53963eb1c7d96c91bb327c2a20
time: 0-2:00:00
interactive_debug_session: false
interactive_debug: false

params:
  name: "local_search_relative_moe_short"
  ff_mode: token_choice
  capacity_factor: 1.0

  activation_type: silu
  moe_inner_expert: ff_gated
  expansion_rate: 8
  granularity: 1
  get_router_values_from: weights
  layer_norm_in_expert_choice: False

  batch_size: 512
  cutoff: 256

  n_steps: 4_000
  final_lr_step: 4_000
  lr_warmup_steps: 40
  scheduler: cosine

  final_lr_fraction: 0.066666
  init_scale: 0.333
  learning_rate: 0.003
  weight_decay: 0.15

  save_weights_interval: 0
  mixed_precision: True
  loss_checkpoint_chungs: 4

  print_parameter_names: true
  relative_lr:
    embedding_layer: 3.333
    head: 0.444
    gating: 1.
    expert_inner_function: 0.3

  relative_init_scale:
    embedding_layer: 0.2
    head: 1.
    gating: 0.2
    expert_inner_function: 1.

  relative_scheduler_fraction:
    embedding_layer: 2.222
    head: 0.444
    gating: 1.
    expert_inner_function: 0.5


tune_config:
  iters: 30
  tune_params:
    - "learning_rate"
    - "relative_lr:embedding_layer"
    - "relative_lr:head"
    - "relative_lr:expert_inner_function"
    - "relative_lr:gating"
#    - "init_scale"
#    - "relative_init_scale:embedding_layer"
#    - "relative_init_scale:head"
#    - "relative_init_scale:expert_inner_function"
#    - "relative_init_scale:gating"
    - "final_lr_fraction"
    - "relative_scheduler_fraction:embedding_layer"
    - "relative_scheduler_fraction:head"
    - "relative_scheduler_fraction:expert_inner_function"
    - "relative_scheduler_fraction:gating"
